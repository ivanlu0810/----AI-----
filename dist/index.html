<!DOCTYPE html>
<html lang="en">
<!-- ÁµÑÂì°‰∏äÂÇ≥Â∞±Ë¶ÅÂü∑Ë°åÈÄôÊÆµÊåá‰ª§ÂêåÊ≠• git pull origin main -->
<script src="https://cdn.jsdelivr.net/npm/echarts@5/dist/echarts.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/echarts-liquidfill@3/dist/echarts-liquidfill.min.js"></script>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÂÅ•ÁøíÁîüÔΩúÂÅ•Â∫∑ÂÑÄË°®Êùø</title>
    <link rel="icon" href="images/fitness.png" type="image/png">

    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="assets/css/bootstrap.css">
    <link rel="stylesheet" href="assets/vendors/iconly/bold.css">

    <link rel="stylesheet" href="assets/vendors/bootstrap-icons/bootstrap-icons.css">
    <link rel="stylesheet" href="assets/css/app.css">

    <link rel="stylesheet" href="assets/css/chatbox.css" />
    <link rel="shortcut icon" href="assets/images/favicon.svg" type="image/x-icon">

    <style>
        .stats-icon.orange {
            background-color: #ff9500;
            color: white;
        }

        .stats-icon.teal {
            background-color: #20c997;
            color: white;
        }

        .stats-icon.indigo {
            background-color: #6610f2;
            color: white;
        }

        .stats-icon.pink {
            background-color: #e83e8c;
            color: white;
        }

        /* Á¢∫‰øù‰∏ªË¶ÅÂÖßÂÆπÂçÄÂüüÂèØ‰ª•ÊªæÂãï */
        #main {
            height: 100vh !important;
            overflow-y: auto !important;
        }

        /* Á¢∫‰øùÂÖßÂÆπË∂≥Â§†Èï∑‰ª•Ëß∏ÁôºÊªæÂãï */
        .page-content {
            min-height: 120vh !important;
            padding-bottom: 50px !important;
        }

        html,
        body {
            height: 100%;
            overflow: hidden;
        }

        .card {
            border-radius: 16px;
            /* Áµ±‰∏ÄÂúìËßí */
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
            /* ÊüîÂíåÈô∞ÂΩ± */
            margin-bottom: 20px;
            /* ‰∏ãÊñπÁïôÁôΩ */
        }

        .card .card-body {
            padding: 1.25rem;
            /* ËÆìÂÖßË∑ù‰∏ÄËá¥ */
        }

        .card-body {
            padding-top: 1.5rem !important;
            /* È†êË®≠Â§ßÁ¥Ñ 1remÔºåÂä†Â§ß‰∏ÄÈªû */
            padding-bottom: 1.5rem !important;
        }

        .col-lg-3 .card {
            margin-bottom: 24px;
        }

        .card-header {
            padding: 1.2rem 1rem !important;
            /* ‰∏ä‰∏ãÈñìË∑ù */
            background-color: #f5f7fa;
            /* Ê∑°Ê∑°ÁöÑÁÅ∞ËóçËâ≤ËÉåÊôØ */
            border-bottom: 1px solid #e0e0e0;
            /* ‰∏ãÈÇäÊ°ÜÊ∑°ÁÅ∞ */
            border-radius: 12px 12px 0 0;
            /* ËÆìÊ®ôÈ°åÂçÄÂüüÂúìËßíÊõ¥ÊüîÂíå */
        }

        .card-header h4 {
            margin: 0;
            line-height: 1.6;
            font-size: 1.25rem;
            font-weight: 700;
            color: #34495e;
            /* Ê∑±ÁÅ∞ËóçÔºåÊñáÂ≠óÊõ¥Á©©Èáç */
        }

        /* Áî®Êà∂Â§ßÈ†≠Ë≤ºÊ®£Âºè */
        .avatar.avatar-xl {
            width: 80px !important;
            height: 80px !important;
            border-radius: 50% !important;
            overflow: hidden;
        }

        .avatar img {
            width: 100% !important;
            height: 100% !important;
            object-fit: cover !important;
            border-radius: 50% !important;
            border: 2px solid #e0e0e0;
            transition: border-color 0.3s ease;
        }

        .avatar img:hover {
            border-color: #95abc3;
        }
    </style>
</head>

<body>
    <div id="app">

        <!-- ËÅäÂ§©Ê∞£Ê≥° -->
        <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

        <div id="chat-container" class="position-relative">
            <div id="chat-icon" class="chat-icon">
                <img src="assets/images/chat-icon.png" alt="chat icon" />`
            </div>
            <div id="chat-window" class="chat-window">
                <div class="header">AIÂÅ•ÁøíÁîü</div>
                <div class="body">
                    <div class="message">‰Ω†Â•ΩÔºåÊúâ‰ªÄÈ∫ºÂèØ‰ª•Âπ´ÂøôÁöÑÂóéÔºü</div>
                    <div id="user-id" style="display: none;"></div>
                </div>
                <div class="footer">
                    <input type="text" placeholder="Ëº∏ÂÖ•Ë®äÊÅØ..." />
                    <button>ÁôºÈÄÅ</button>
                </div>
            </div>
        </div>

        <script src="assets/js/chatbox.js"></script>
        <!-- ËÅäÂ§©Ê∞£Ê≥°ÁµêÊùü -->

        <div id="sidebar" class="active">
            <div class="sidebar-wrapper active">
                <div class="sidebar-menu">
                    <ul class="menu">
                        <li class="sidebar-title">ÊàëÁöÑÊ™îÊ°à</li>

                        <li class="sidebar-item active">
                            <a href="index.html" class='sidebar-link'>
                                <i class="bi bi-file-earmark-medical-fill"></i>
                                <span>ÂÅ•Â∫∑ÂÑÄË°®Êùø</span>
                            </a>
                        </li>
                        <li class="sidebar-item">
                            <a href="profile.html" class='sidebar-link'>
                                <i class="bi bi-person-badge-fill"></i>
                                <span>Âü∫Êú¨Ë≥áÊñô</span>
                            </a>
                        </li>
                        <li class="sidebar-item">
                            <a href="history.html" class='sidebar-link'>
                                <i class="bi bi-pen-fill"></i>
                                <span>Ê≠∑Âè≤Á¥ÄÈåÑ</span>
                            </a>
                        </li>
                        <li class="sidebar-title">Êô∫ÊÖßÂª∫Ë≠∞</li>
                        <li class="sidebar-item">
                            <a href="training.html" class='sidebar-link'>
                                <i class="bi bi-pentagon-fill"></i>
                                <span>Ë®ìÁ∑¥Êé¢Á¥¢</span>
                            </a>
                        </li>
                        <li class="sidebar-item">
                            <a href="food.html" class='sidebar-link'>
                                <i class="bi bi-basket-fill"></i>
                                <span>È£≤È£üÊåáÂçó</span>
                            </a>
                        </li>
                        <li class="sidebar-item">
                            <a href="favorite.html" class='sidebar-link'>
                                <i class="bi bi-grid-1x2-fill"></i>
                                <span>ÊàëÁöÑÊúÄÊÑõ</span>
                            </a>
                        </li>
                        <li class="sidebar-title">Êõ¥Â§öÈÅ∏È†Ö</li>
                        <li class="sidebar-item">
                            <a href="logout.php" class='sidebar-link'>
                                <i class="bi bi-egg-fill"></i>
                                <span>ÁôªÂá∫Â∏≥Êà∂</span>
                            </a>
                        </li>
                    </ul>
                </div>
                <button class="sidebar-toggler btn x"><i data-feather="x"></i></button>
            </div>
        </div>
        <div id="main">
            <header class="mb-3">
                <a href="#" class="burger-btn d-block d-xl-none">
                    <i class="bi bi-justify fs-3"></i>
                </a>
            </header>

            <div class="page-heading">
                <div class="d-flex align-items-center">
                    <h3 class="mb-0 me-3">ÂÅ•Â∫∑ÂÑÄË°®Êùøüîé
                    </h3>
                    <button class="btn btn-custom d-flex align-items-center" data-bs-toggle="modal"
                        data-bs-target="#addDataModal">
                        <i class="bi bi-plus-circle me-2"></i>Êñ∞Â¢ûÊï∏Êìö
                    </button>
                </div>
            </div>
            <p class="text-muted mt-2 mb-4" style="font-size: 1rem;">
                ‰ª•‰∏ãÁÇ∫ÊÇ®ÁõÆÂâçÊúÄÊñ∞ÁöÑÂü∫Êú¨Ë∫´È´îË≥áÊñôÔºåÁ≥ªÁµ±ÊúÉËá™ÂãïÁµ±Ë®àÊúÄËøë‰∏ÄÊ¨°ÁöÑÊï∏ÂÄºÈ°ØÁ§∫Êñº‰∏ãÊñπ„ÄÇ
            </p>
            <div class="page-content">
                <section class="row">
                    <div class="col-12 col-lg-9">
                        <div class="row">
                            <div class="col-12 col-sm-6 col-md-6 col-lg-3">
                                <div class="card">
                                    <div class="card-body d-flex justify-content-center align-items-center">
                                        <div class="d-flex align-items-center">
                                            <!-- Á¥´Ëâ≤ ICON -->
                                            <div class="stats-icon morandi-purple me-3">
                                                <img src="icons/clipboard-data.svg" alt="Clipboard Data"
                                                    class="icon-svg white-filter">
                                            </div>
                                            <!-- ÊñáÂ≠óÂÖßÂÆπ -->
                                            <div class="text-center">
                                                <h6 class="text-muted font-semibold">Ë®òÈåÑÁ≠ÜÊï∏</h6>
                                                <h6 class="font-extrabold mb-0" id="total-records">0 Á≠Ü</h6>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-12 col-sm-6 col-md-6 col-lg-3">
                                <div class="card">
                                    <div class="card-body d-flex justify-content-center align-items-center">
                                        <div class="d-flex align-items-center">
                                            <div class="stats-icon morandi-blue me-3">
                                                <img src="icons/ruler-combined-solid.svg" alt="Ruler-Combined-Solid"
                                                    class="icon-svg white-filter">
                                            </div>
                                            <div class="text-center">
                                                <h6 class="text-muted font-semibold">Ë∫´È´ò</h6>
                                                <h6 class="font-extrabold mb-0" id="avg-height">0.0 cm</h6>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-12 col-sm-6 col-md-6 col-lg-3">
                                <div class="card">
                                    <div class="card-body d-flex justify-content-center align-items-center">
                                        <div class="d-flex align-items-center">
                                            <div class="stats-icon morandi-green me-3">
                                                <img src="icons/speedometer2.svg" alt="speedometer2"
                                                    class="icon-svg white-filter">
                                            </div>
                                            <div class="text-center">
                                                <h6 class="text-muted font-semibold">È´îÈáç</h6>
                                                <h6 class="font-extrabold mb-0" id="avg-weight">0.0 kg</h6>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-12 col-sm-6 col-md-6 col-lg-3">
                                <div class="card">
                                    <div class="card-body d-flex justify-content-center align-items-center">
                                        <div class="d-flex align-items-center">
                                            <div class="stats-icon morandi-pink me-3">
                                                <img src="icons/clipboard-account.svg" alt="clipboard-account"
                                                    class="icon-svg white-filter">
                                            </div>
                                            <div class="text-center">
                                                <h6 class="text-muted font-semibold">BMI</h6>
                                                <h6 class="font-extrabold mb-0" id="avg-bmi">0.0</h6>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-12 col-sm-6 col-md-6 col-lg-3">
                                <div class="card">
                                    <div class="card-body d-flex justify-content-center align-items-center">
                                        <div class="d-flex align-items-center">
                                            <div class="stats-icon morandi-apricot me-3">
                                                <img src="icons/fire-solid.svg" alt="muscle-gain"
                                                    class="icon-svg white-filter">
                                            </div>
                                            <div class="text-center">
                                                <h6 class="text-muted font-semibold">Âü∫Á§é‰ª£Ë¨ù</h6>
                                                <h6 class="font-extrabold mb-0" id="avg-metabolism">0 kcal</h6>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-12 col-sm-6 col-md-6 col-lg-3">
                                <div class="card">
                                    <div class="card-body d-flex justify-content-center align-items-center">
                                        <div class="d-flex align-items-center">
                                            <div class="stats-icon morandi-graygreen me-3">
                                                <img src="icons/muscle-gain.svg" alt="muscle-gain"
                                                    class="icon-svg white-filter">
                                            </div>
                                            <div class="text-center">
                                                <h6 class="text-muted font-semibold">È™®È™ºËÇå</h6>
                                                <h6 class="font-extrabold mb-0" id="avg-skeletal">0.0 kg</h6>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-12 col-sm-6 col-md-6 col-lg-3">
                                <div class="card">
                                    <div class="card-body d-flex justify-content-center align-items-center">
                                        <div class="d-flex align-items-center">
                                            <div class="stats-icon morandi-gray me-3">
                                                <img src="icons/pie-chart.svg" alt="muscle-gain"
                                                    class="icon-svg white-filter">
                                            </div>
                                            <div class="text-center">
                                                <h6 class="text-muted font-semibold">È´îËÑÇËÇ™</h6>
                                                <h6 class="font-extrabold mb-0" id="avg-body-fat">0.0 kg</h6>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-12 col-sm-6 col-md-6 col-lg-3">
                                <div class="card">
                                    <div class="card-body d-flex justify-content-center align-items-center">
                                        <div class="d-flex align-items-center">
                                            <div class="stats-icon morandi-cream me-3">
                                                <img src="icons/add-chart.svg" alt="muscle-gain"
                                                    class="icon-svg white-filter">
                                            </div>
                                            <div class="text-center">
                                                <h6 class="text-muted font-semibold">È´îËÑÇÁéá</h6>
                                                <h6 class="font-extrabold mb-0" id="avg-fat-percentage">0.0%</h6>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- ÊôÇÈñìÁØÑÂúçÈÅ∏ÊìáÂô® -->
                        <div class="row mb-4">
                            <div class="col-12">
                                <div class="card">
                                    <div class="card-body">
                                        <div class="d-flex align-items-center justify-content-between">
                                            <h6 class="mb-0">ÂúñË°®ÊôÇÈñìÁØÑÂúç</h6>
                                            <div class="d-flex align-items-center">
                                                <input type="date" id="start-date" class="form-control me-2" style="width: auto;">
                                                <span class="me-2">Ëá≥</span>
                                                <input type="date" id="end-date" class="form-control me-3" style="width: auto;">
                                                                                                 <button class="btn btn-primary btn-sm" id="apply-date-range">Â•óÁî®ÁØÑÂúç</button>
                                                 <button class="btn btn-outline-secondary btn-sm ms-2" id="reset-date-range">ÈáçÁΩÆ</button>
                                                 <button class="btn btn-outline-info btn-sm ms-2" id="last-30-days">ÊúÄËøë30Â§©</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-12 col-lg-6">
                                <div class="card">
                                    <div class="card-header">
                                        <h4 class="card text-center">È´îÈáçËÆäÂåñË∂®Âã¢</h4>
                                    </div>
                                    <div class="card-body">
                                        <div id="weight-chart"></div>
                                    </div>
                                </div>
                            </div>

                            <div class="col-12 col-lg-6">
                                <div class="card">
                                    <div class="card-header">
                                        <h4 class="card text-center">Ë∫´È´îÁµÑÊàêËÆäÂåñ</h4>
                                    </div>
                                    <div class="card-body">
                                        <div id="body-composition-chart"></div>
                                    </div>
                                </div>
                            </div>

                            <div class="col-12 col-lg-6">
                                <div class="card">
                                    <div class="card-header">
                                        <h4 class="card text-center">È´îËÑÇÁéáËÆäÂåñË∂®Âã¢</h4>
                                    </div>
                                    <div class="card-body">
                                        <div id="fat-percentage-chart"></div>
                                    </div>
                                </div>
                            </div>

                            <div class="col-12 col-lg-6">
                                <div class="card">
                                    <div class="card-header">
                                        <h4 class="card text-center">BMIËÆäÂåñË∂®Âã¢</h4>
                                    </div>
                                    <div class="card-body">
                                        <div id="bmi-chart"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-12 col-lg-3">
                        <div class="card">
                            <div class="card-body py-4 px-5">
                                <div class="d-flex align-items-center">
                                    <div class="avatar avatar-xl">
                                        <img src="assets/images/faces/1.jpg" alt="È†êË®≠Â§ßÈ†≠Ë≤º">
                                    </div>
                                    <div class="ms-3 name">
                                        <h5 class="font-bold" id="user-name">John Duck</h5>
                                        <h6 class="text-muted mb-0" id="user-email">@johnducky</h6>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="card text-center">
                            <div class="card-header">
                                <h4 class="fw-bold">ÂÅ•Â∫∑ÁõÆÊ®ôËøΩËπ§</h4>
                            </div>
                            <div class="card-content pb-4">

                                <!-- ‚úÖ ÊØè‰∏ÄÂàóÂåÖÂú® w-75 ÁöÑ containerÔºå‰∏¶Èù†‰∏≠Â∞çÈΩä -->
                                <div class="mx-auto w-75 d-flex align-items-start justify-content-start py-3">
                                    <div class="goal-icon rounded-circle d-flex align-items-center justify-content-center me-3"
                                        style="width: 40px; height: 40px; background-color: #c1cdd7; overflow: hidden; flex-shrink: 0;">
                                        <img src="images/barbell.png" alt="ÁõÆÊ®ôÈ´îÈáç"
                                            style="width: 60%; height: 60%; object-fit: contain; filter: brightness(0) invert(1);">
                                    </div>
                                    <div class="text-start flex-grow-1">
                                        <h6 class="mb-2 fw-bold text-dark">ÁõÆÊ®ôÈ´îÈáç</h6>
                                        <div class="d-flex align-items-center" style="min-width: 0;">
                                            <div class="text-muted fw-normal" style="min-width: 80px;">ÁõÆÂâç: <span id="current-weight" class="fw-semibold">0.0</span> kg</div>
                                            <i class="bi bi-arrow-right text-muted mx-2"></i>
                                            <div class="text-primary fw-semibold">ÁõÆÊ®ô: <span id="goal-weight-display" class="fw-bold">70.0</span> kg</div>
                                        </div>
                                    </div>
                                </div>

                                <div class="mx-auto w-75 d-flex align-items-start justify-content-start py-3">
                                    <div class="goal-icon rounded-circle d-flex align-items-center justify-content-center me-3"
                                        style="width: 40px; height: 40px; background-color: #cfddd6; overflow: hidden; flex-shrink: 0;">
                                        <img src="images/up.png" alt="ÁõÆÊ®ôÈ´îËÑÇÁéá"
                                            style="width: 60%; height: 60%; object-fit: contain; filter: brightness(0) invert(1);">
                                    </div>
                                    <div class="text-start flex-grow-1">
                                        <h6 class="mb-2 fw-bold text-dark">ÁõÆÊ®ôÈ´îËÑÇÁéá</h6>
                                        <div class="d-flex align-items-center" style="min-width: 0;">
                                            <div class="text-muted fw-normal" style="min-width: 80px;">ÁõÆÂâç: <span id="current-fat-percentage" class="fw-semibold">0.0</span>%</div>
                                            <i class="bi bi-arrow-right text-muted mx-2"></i>
                                            <div class="text-primary fw-semibold">ÁõÆÊ®ô: <span id="goal-fat-percentage-display" class="fw-bold">15.0</span>%</div>
                                        </div>
                                    </div>
                                </div>

                                <div class="mx-auto w-75 d-flex align-items-start justify-content-start py-3">
                                    <div class="goal-icon rounded-circle d-flex align-items-center justify-content-center me-3"
                                        style="width: 40px; height: 40px; background-color: #e6d4da; overflow: hidden; flex-shrink: 0;">
                                        <img src="images/line-chart.png" alt="ÁõÆÊ®ôËÇåËÇâÈáè"
                                            style="width: 60%; height: 60%; object-fit: contain; filter: brightness(0) invert(1);">
                                    </div>
                                    <div class="text-start flex-grow-1">
                                        <h6 class="mb-2 fw-bold text-dark">ÁõÆÊ®ôËÇåËÇâÈáè</h6>
                                        <div class="d-flex align-items-center" style="min-width: 0;">
                                            <div class="text-muted fw-normal" style="min-width: 80px;">ÁõÆÂâç: <span id="current-muscle" class="fw-semibold">0.0</span> kg</div>
                                            <i class="bi bi-arrow-right text-muted mx-2"></i>
                                            <div class="text-primary fw-semibold">ÁõÆÊ®ô: <span id="goal-muscle-display" class="fw-bold">35.0</span> kg</div>
                                        </div>
                                    </div>
                                </div>
                                <div class="px-4">
                                    <button class="btn btn-block btn-xl btn-light-primary font-bold mt-3" data-bs-toggle="modal" data-bs-target="#setGoalModal">Ë®≠ÂÆöÁõÆÊ®ô</button>
                                </div>
                            </div>
                        </div>
                        <div class="card text-center equal-h">
                            <div class="card-header">
                                <h4 class="fw-bold">ÁõÆÊ®ôÈÅîÊàêÁéá</h4>
                            </div>
                            <div class="card-body d-flex flex-column justify-content-center align-items-center">
                                <div id="goal-progress-chart"
                                    style="width: 100%; aspect-ratio: 1/1; max-height: 200px;"></div>
                                <p class="mt-3 text-muted">Èõ¢ÁõÆÊ®ôÂè™Â∑Æ‰∏ÄÈªûÔºåÂä†Ê≤πÔºÅ</p>
                            </div>
                        </div>
                        <div class="card equal-h">
                            <div class="card-header">
                                <h4 class="text-center">Ë∫´È´îÁµÑÊàêÊØî‰æã</h4>
                            </div>
                            <div class="card-body d-flex flex-column justify-content-center align-items-center">
                                <div id="body-composition-pie-chart"></div>
                            </div>
                        </div>
                    </div>
                </section>
            </div>

            <footer>
                <div class="footer clearfix mb-0 text-muted">
                    <div class="float-start">
                        <p>ÂÅ•ÁøíÁîü</p>
                    </div>
                    <div class="float-end">
                        <p>Ë¨ùÊòÄÂÄ¢ ÈªÉË©†Áø∞ ÂëÇÊ≤ÅÂû£ Ê∏∏ÂçöÁøî</p>
                    </div>
                </div>
            </footer>
        </div>
    </div>
    <script src="assets/vendors/perfect-scrollbar/perfect-scrollbar.min.js"></script>
    <script src="assets/js/bootstrap.bundle.min.js"></script>

    <script src="assets/vendors/apexcharts/apexcharts.js"></script>
    <script src="assets/js/pages/dashboard.js"></script>

    <script src="assets/js/main.js"></script>

    <!-- Ë®≠ÂÆöÁõÆÊ®ôÂΩàÂá∫Ë¶ñÁ™ó -->
    <div class="modal fade" id="setGoalModal" tabindex="-1" aria-labelledby="setGoalModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="setGoalModalLabel">Ë®≠ÂÆöÂÅ•Â∫∑ÁõÆÊ®ô</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="goalForm">
                        <div class="mb-3">
                            <label for="goal_weight" class="form-label">ÁõÆÊ®ôÈ´îÈáç (kg)</label>
                            <input type="number" class="form-control" id="goal_weight" name="goal_weight" step="0.1" min="30" max="200" value="70.0">
                        </div>
                        <div class="mb-3">
                            <label for="goal_fat_percentage" class="form-label">ÁõÆÊ®ôÈ´îËÑÇÁéá (%)</label>
                            <input type="number" class="form-control" id="goal_fat_percentage" name="goal_fat_percentage" step="0.1" min="5" max="50" value="15.0">
                        </div>
                        <div class="mb-3">
                            <label for="goal_muscle" class="form-label">ÁõÆÊ®ôËÇåËÇâÈáè (kg)</label>
                            <input type="number" class="form-control" id="goal_muscle" name="goal_muscle" step="0.1" min="10" max="100" value="35.0">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ÂèñÊ∂à</button>
                    <button type="button" class="btn btn-primary" id="saveGoalBtn">‰øùÂ≠òÁõÆÊ®ô</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Êñ∞Â¢ûÊï∏ÊìöÂΩàÂá∫Ë¶ñÁ™ó -->
    <div class="modal fade" id="addDataModal" tabindex="-1" aria-labelledby="addDataModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addDataModalLabel">Êñ∞Â¢ûÂÅ•Â∫∑Êï∏Êìö</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="healthDataForm">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="test_date" class="form-label">Ê∏¨ÈáèÊó•Êúü</label>
                                <input type="date" class="form-control" id="test_date" name="test_date">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="age" class="form-label">Âπ¥ÈΩ° *</label>
                                <input type="number" class="form-control" id="age" name="age" min="1" max="120"
                                    required>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="height_cm" class="form-label">Ë∫´È´ò (cm) *</label>
                                <input type="number" class="form-control" id="height_cm" name="height_cm" step="0.1"
                                    min="50" max="250" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="weight_kg" class="form-label">È´îÈáç (kg) *</label>
                                <input type="number" class="form-control" id="weight_kg" name="weight_kg" step="0.1"
                                    min="20" max="300" required>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="skeletal_muscle" class="form-label">È™®È™ºËÇåÈáç (kg)</label>
                                <input type="number" class="form-control" id="skeletal_muscle" name="skeletal_muscle"
                                    step="0.1">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="body_fat" class="form-label">È´îËÑÇËÇ™Èáç (kg)</label>
                                <input type="number" class="form-control" id="body_fat" name="body_fat" step="0.1">
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="fat_percentage" class="form-label">È´îËÑÇÁéá (%)</label>
                                <input type="number" class="form-control" id="fat_percentage" name="fat_percentage"
                                    step="0.1">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="basal_metabolism" class="form-label">Âü∫Á§é‰ª£Ë¨ùÈáè (kcal)</label>
                                <input type="number" class="form-control" id="basal_metabolism" name="basal_metabolism"
                                    step="0.1">
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="bmi" class="form-label">BMI (ÂèØÈÅ∏)</label>
                                <input type="number" class="form-control" id="bmi" name="bmi" step="0.1">
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ÂèñÊ∂à</button>
                    <button type="button" class="btn btn-primary" id="saveDataBtn">‰øùÂ≠òÊï∏Êìö</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ÊàêÂäüÊèêÁ§∫Ë¶ñÁ™ó -->
    <div class="modal fade" id="successModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">ÊàêÂäü</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p id="successMessage">Êï∏Êìö‰øùÂ≠òÊàêÂäüÔºÅ</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Á¢∫ÂÆö</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ÈåØË™§ÊèêÁ§∫Ë¶ñÁ™ó -->
    <div class="modal fade" id="errorModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">ÈåØË™§</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p id="errorMessage">‰øùÂ≠òÊï∏ÊìöÊôÇÁôºÁîüÈåØË™§„ÄÇ</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Á¢∫ÂÆö</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Ë®≠ÁΩÆ‰ªäÂ§©ÁöÑÊó•ÊúüÁÇ∫ÈªòË™çÂÄºÔºà‰ΩøÁî®Êú¨Âú∞ÊôÇÂçÄÔºâ
        const today = new Date();
        const year = today.getFullYear();
        const month = String(today.getMonth() + 1).padStart(2, '0');
        const day = String(today.getDate()).padStart(2, '0');
        document.getElementById('test_date').value = `${year}-${month}-${day}`;

        // ËºâÂÖ•Áî®Êà∂Ë≥áË®ä
        fetch('get_user_info.php')
            .then(response => {
                if (response.ok) {
                    return response.json();
                } else {
                    // Â¶ÇÊûúÊú™ÁôªÂÖ•ÔºåË∑≥ËΩâÂà∞ÁôªÂÖ•È†ÅÈù¢
                    window.location.href = 'auth-login.html';
                    throw new Error('Not logged in');
                }
            })
            .then(data => {
                // Êõ¥Êñ∞Áî®Êà∂Ë≥áË®ä
                document.getElementById('user-id').textContent = data.userid;
                document.getElementById('user-name').textContent = data.username;
                document.getElementById('user-email').textContent = data.email;
                
                // Êõ¥Êñ∞Áî®Êà∂Â§ßÈ†≠Ë≤º
                const userAvatar = document.querySelector('.avatar img');
                if (data.avatar && data.avatar.trim() !== '') {
                    userAvatar.src = data.avatar;
                    userAvatar.alt = data.username + ' ÁöÑÂ§ßÈ†≠Ë≤º';
                } else {
                    // Â¶ÇÊûúÊ≤íÊúâ‰∏äÂÇ≥Â§ßÈ†≠Ë≤ºÔºå‰ΩøÁî®È†êË®≠ÂúñÁâá
                    userAvatar.src = 'assets/images/faces/1.jpg';
                    userAvatar.alt = 'È†êË®≠Â§ßÈ†≠Ë≤º';
                }
            })
            .catch(error => {
                console.error('Error loading user info:', error);
            });

        // ËºâÂÖ•ÂÅ•Â∫∑Êï∏ÊìöÁµ±Ë®à
        fetch('get_health_stats.php')
            .then(response => {
                if (response.ok) {
                    return response.json();
                } else {
                    throw new Error('Failed to load health stats');
                }
            })
            .then(data => {
                // Êõ¥Êñ∞Áµ±Ë®àÊï∏ÊìöÔºàÈ°ØÁ§∫ÊúÄÊñ∞Ë®òÈåÑÔºâ
                document.getElementById('total-records').textContent = data.total_records + ' Á≠Ü';
                document.getElementById('avg-weight').textContent = data.latest_weight + ' kg';
                document.getElementById('avg-height').textContent = data.latest_height + ' cm';
                document.getElementById('avg-skeletal').textContent = data.latest_skeletal_muscle + ' kg';
                document.getElementById('avg-body-fat').textContent = data.latest_body_fat + ' kg';
                document.getElementById('avg-fat-percentage').textContent = data.latest_fat_percentage + '%';
                document.getElementById('avg-metabolism').textContent = data.latest_basal_metabolism + ' kcal';
                document.getElementById('avg-bmi').textContent = data.latest_bmi;

                // Êõ¥Êñ∞ÁõÆÊ®ôËøΩËπ§ÁöÑÁõÆÂâçÊï∏Êìö
                document.getElementById('current-weight').textContent = data.latest_weight;
                document.getElementById('current-fat-percentage').textContent = data.latest_fat_percentage;
                document.getElementById('current-muscle').textContent = data.latest_skeletal_muscle;

                // Êõ¥Êñ∞ÁõÆÊ®ôÈÅîÊàêÁéáÂúñË°®
                if (window.goalProgressChart) {
                    window.goalProgressChart.update();
                }
            })
            .catch(error => {
                console.error('Error loading health stats:', error);
            });

        // ËºâÂÖ•ÂúñË°®Êï∏Êìö
        function loadChartData(startDate = null, endDate = null) {
            let url = 'get_chart_data.php';
            const params = new URLSearchParams();
            
            if (startDate && endDate) {
                params.append('start_date', startDate);
                params.append('end_date', endDate);
                url += '?' + params.toString();
                console.log('Loading chart data with date range:', startDate, 'to', endDate);
            } else {
                console.log('Loading all chart data (no date filter)');
            }
            
            console.log('Loading chart data from:', url);
            
            fetch(url)
                .then(response => {
                    if (response.ok) {
                        return response.json();
                    } else {
                        throw new Error('Failed to load chart data');
                    }
                })
                .then(data => {
                    console.log('Chart data received:', data);
                    console.log('Total records:', data.total_records);
                    console.log('Date filter applied:', data.date_filter_applied);
                    console.log('Filter start date:', data.filter_start_date);
                    console.log('Filter end date:', data.filter_end_date);
                    console.log('Dates:', data.dates);
                    console.log('Weight data:', data.weight);
                    
                    if (data.dates && data.dates.length > 0) {
                        createWeightChart(data);
                        createBodyCompositionChart(data);
                        createFatPercentageChart(data);
                        createBMIChart(data);
                    } else {
                        console.warn('No chart data available');
                    }
                })
                .catch(error => {
                    console.error('Error loading chart data:', error);
                });
        }

        // ÂâµÂª∫È´îÈáçËÆäÂåñÂúñË°®
        function createWeightChart(data) {
            // Ê∏ÖÈô§ËàäÁöÑÂúñË°®
            const chartContainer = document.querySelector("#weight-chart");
            chartContainer.innerHTML = '';
            
            const weightData = data.weight.filter(val => val !== null);
            const dates = data.dates.filter((_, index) => data.weight[index] !== null);

            if (weightData.length === 0) return;

            const options = {
                series: [{
                    name: 'È´îÈáç (kg)',
                    data: weightData
                }],
                chart: {
                    type: 'line',
                    height: 390,
                    toolbar: {
                        show: false
                    }
                },
                colors: ['#AB8B8B'],
                dataLabels: {
                    enabled: true,
                    formatter: function (val) {
                        return val.toFixed(1);
                    }
                },
                stroke: {
                    curve: 'smooth',
                    width: 3
                },
                xaxis: {
                    categories: dates,
                    labels: {
                        formatter: function (value) {
                            return new Date(value).toLocaleDateString('zh-TW', {
                                month: 'short',
                                day: 'numeric'
                            });
                        }
                    }
                },
                yaxis: {
                    title: {
                        text: 'È´îÈáç (kg)'
                    }
                },
                tooltip: {
                    x: {
                        format: 'dd/MM/yyyy'
                    }
                }
            };

            const chart = new ApexCharts(chartContainer, options);
            chart.render();
        }

        // ÂâµÂª∫Ë∫´È´îÁµÑÊàêÂúñË°®
        function createBodyCompositionChart(data) {
            // Ê∏ÖÈô§ËàäÁöÑÂúñË°®
            const chartContainer = document.querySelector("#body-composition-chart");
            chartContainer.innerHTML = '';
            
            const skeletalData = data.skeletal_muscle.filter(val => val !== null);
            const bodyFatData = data.body_fat.filter(val => val !== null);
            const dates = data.dates.filter((_, index) =>
                data.skeletal_muscle[index] !== null || data.body_fat[index] !== null
            );

            if (skeletalData.length === 0 && bodyFatData.length === 0) return;

            const options = {
                series: [{
                    name: 'È™®È™ºËÇåÈáç (kg)',
                    data: skeletalData
                }, {
                    name: 'È´îËÑÇËÇ™Èáç (kg)',
                    data: bodyFatData
                }],
                chart: {
                    type: 'line',
                    height: 390,
                    toolbar: {
                        show: false
                    }
                },
                colors: ['#99898C', '#60575A'],
                dataLabels: {
                    enabled: true,
                    formatter: function (val) {
                        return val.toFixed(1);
                    }
                },
                stroke: {
                    curve: 'smooth',
                    width: 3
                },
                xaxis: {
                    categories: dates,
                    labels: {
                        formatter: function (value) {
                            return new Date(value).toLocaleDateString('zh-TW', {
                                month: 'short',
                                day: 'numeric'
                            });
                        }
                    }
                },
                yaxis: {
                    title: {
                        text: 'ÈáçÈáè (kg)'
                    }
                },
                tooltip: {
                    x: {
                        format: 'dd/MM/yyyy'
                    }
                }
            };

            const chart = new ApexCharts(chartContainer, options);
            chart.render();
        }

        // ÂâµÂª∫È´îËÑÇÁéáËÆäÂåñÂúñË°®
        function createFatPercentageChart(data) {
            // Ê∏ÖÈô§ËàäÁöÑÂúñË°®
            const chartContainer = document.querySelector("#fat-percentage-chart");
            chartContainer.innerHTML = '';
            
            const fatPercentageData = data.fat_percentage.filter(val => val !== null);
            const dates = data.dates.filter((_, index) => data.fat_percentage[index] !== null);

            if (fatPercentageData.length === 0) return;

            const options = {
                series: [{
                    name: 'È´îËÑÇÁéá (%)',
                    data: fatPercentageData
                }],
                chart: {
                    type: 'line',
                    height: 390,
                    toolbar: {
                        show: false
                    }
                },
                colors: ['#745E60'],
                dataLabels: {
                    enabled: true,
                    formatter: function (val) {
                        return val.toFixed(1);
                    }
                },
                stroke: {
                    curve: 'smooth',
                    width: 3
                },
                xaxis: {
                    categories: dates,
                    labels: {
                        formatter: function (value) {
                            return new Date(value).toLocaleDateString('zh-TW', {
                                month: 'short',
                                day: 'numeric'
                            });
                        }
                    }
                },
                yaxis: {
                    title: {
                        text: 'È´îËÑÇÁéá (%)'
                    }
                },
                tooltip: {
                    x: {
                        format: 'dd/MM/yyyy'
                    }
                }
            };

            const chart = new ApexCharts(chartContainer, options);
            chart.render();
        }

        // ÂâµÂª∫BMIËÆäÂåñÂúñË°®
        function createBMIChart(data) {
            // Ê∏ÖÈô§ËàäÁöÑÂúñË°®
            const chartContainer = document.querySelector("#bmi-chart");
            chartContainer.innerHTML = '';
            
            const bmiData = data.bmi.filter(val => val !== null);
            const dates = data.dates.filter((_, index) => data.bmi[index] !== null);

            if (bmiData.length === 0) return;

            const options = {
                series: [{
                    name: 'BMI',
                    data: bmiData
                }],
                chart: {
                    type: 'line',
                    height: 390,
                    toolbar: {
                        show: false
                    }
                },
                colors: ['#9C7178'],
                dataLabels: {
                    enabled: true,
                    formatter: function (val) {
                        return val.toFixed(1);
                    }
                },
                stroke: {
                    curve: 'smooth',
                    width: 3
                },
                xaxis: {
                    categories: dates,
                    labels: {
                        formatter: function (value) {
                            return new Date(value).toLocaleDateString('zh-TW', {
                                month: 'short',
                                day: 'numeric'
                            });
                        }
                    }
                },
                yaxis: {
                    title: {
                        text: 'BMI'
                    }
                },
                tooltip: {
                    x: {
                        format: 'dd/MM/yyyy'
                    }
                }
            };

            const chart = new ApexCharts(chartContainer, options);
            chart.render();
        }

        // ÂàùÂßãÂåñÊôÇÈñìÁØÑÂúçÈÅ∏ÊìáÂô®
        function initializeDateRange() {
            // ‰∏çË®≠ÁΩÆÈ†êË®≠ÂÄºÔºåËÆìÁî®Êà∂Ëá™Â∑±ÈÅ∏Êìá
            console.log('Date range selector initialized - no default values set');
        }
        
        // ÊôÇÈñìÁØÑÂúçÈÅ∏ÊìáÂô®‰∫ã‰ª∂ËôïÁêÜ
        document.getElementById('apply-date-range').addEventListener('click', function() {
            const startDate = document.getElementById('start-date').value;
            const endDate = document.getElementById('end-date').value;
            
            if (startDate && endDate) {
                if (startDate > endDate) {
                    alert('ÈñãÂßãÊó•Êúü‰∏çËÉΩÊôöÊñºÁµêÊùüÊó•ÊúüÔºÅ');
                    return;
                }
                console.log('Applying date range:', startDate, 'to', endDate);
                loadChartData(startDate, endDate);
            } else {
                alert('Ë´ãÈÅ∏ÊìáÈñãÂßãÂíåÁµêÊùüÊó•ÊúüÔºÅ');
            }
        });
        
        document.getElementById('reset-date-range').addEventListener('click', function() {
            // Ê∏ÖÈô§Êó•ÊúüÈÅ∏ÊìáÂô®
            document.getElementById('start-date').value = '';
            document.getElementById('end-date').value = '';
            console.log('Date range reset - loading all data');
            loadChartData(); // ËºâÂÖ•ÊâÄÊúâÊï∏Êìö
        });
        
        // ÊúÄËøë30Â§©ÊåâÈàï‰∫ã‰ª∂
        document.getElementById('last-30-days').addEventListener('click', function() {
            const today = new Date();
            const thirtyDaysAgo = new Date();
            thirtyDaysAgo.setDate(today.getDate() - 30);
            
            document.getElementById('start-date').value = thirtyDaysAgo.toISOString().split('T')[0];
            document.getElementById('end-date').value = today.toISOString().split('T')[0];
            console.log('Last 30 days selected:', thirtyDaysAgo.toISOString().split('T')[0], 'to', today.toISOString().split('T')[0]);
            loadChartData(thirtyDaysAgo.toISOString().split('T')[0], today.toISOString().split('T')[0]);
        });
        
        // ÂàùÂßãÂåñÊôÇÈñìÁØÑÂúçÈÅ∏ÊìáÂô®
        initializeDateRange();
        
        // ËºâÂÖ•ÂúñË°®Êï∏Êìö
        loadChartData();
        // ÁõÆÊ®ôÈÅîÊàêÁéáÂúìÁí∞Âúñ - ÂãïÊÖãË®àÁÆó
        function createGoalProgressChart() {
            var chartDom = document.querySelector("#goal-progress-chart");
            var myChart = echarts.init(chartDom);

            // Ë®àÁÆóÁõÆÊ®ôÈÅîÊàêÁéá
            function calculateGoalProgress() {
                const currentWeight = parseFloat(document.getElementById('current-weight').textContent) || 0;
                const currentFatPercentage = parseFloat(document.getElementById('current-fat-percentage').textContent) || 0;
                const currentMuscle = parseFloat(document.getElementById('current-muscle').textContent) || 0;

                const goalWeight = parseFloat(document.getElementById('goal-weight-display').textContent) || 70;
                const goalFatPercentage = parseFloat(document.getElementById('goal-fat-percentage-display').textContent) || 15;
                const goalMuscle = parseFloat(document.getElementById('goal-muscle-display').textContent) || 35;

                // Ë®àÁÆóÂêÑÈ†ÖÊåáÊ®ôÁöÑÈÅîÊàêÁéá (0-100%)
                let weightProgress = 0;
                let fatProgress = 0;
                let muscleProgress = 0;

                // È´îÈáçÈÅîÊàêÁéáÔºöÂü∫ÊñºÁõÆÂâçÈ´îÈáçËàáÁõÆÊ®ôÈ´îÈáçÁöÑÂ∑ÆË∑ùË®àÁÆó
                if (currentWeight > 0 && goalWeight > 0) {
                    if (currentWeight > goalWeight) {
                        // Ê∏õÈáçÊÉÖÊ≥ÅÔºöÁõÆÂâçÈ´îÈáç > ÁõÆÊ®ôÈ´îÈáç
                        // ÂÅáË®≠Ëµ∑ÂßãÈ´îÈáçÊòØÁõÆÊ®ôÈ´îÈáçÁöÑ 1.2 ÂÄçÔºà20% Ë∂ÖÈáçÔºâ
                        const startWeight = goalWeight * 1.2;
                        const totalToLose = startWeight - goalWeight;
                        const alreadyLost = startWeight - currentWeight;
                        weightProgress = Math.min(100, Math.max(0, (alreadyLost / totalToLose) * 100));
                    } else if (currentWeight <= goalWeight) {
                        // Â∑≤ÈÅîÂà∞ÊàñË∂ÖÈÅéÁõÆÊ®ôÈ´îÈáç
                        weightProgress = 100;
                    }
                }

                // È´îËÑÇÁéáÈÅîÊàêÁéáÔºöÂü∫ÊñºÁõÆÂâçÈ´îËÑÇÁéáËàáÁõÆÊ®ôÈ´îËÑÇÁéáÁöÑÂ∑ÆË∑ùË®àÁÆó
                if (currentFatPercentage > 0 && goalFatPercentage > 0) {
                    if (currentFatPercentage > goalFatPercentage) {
                        // Èôç‰ΩéÈ´îËÑÇÁéáÊÉÖÊ≥Å
                        // ÂÅáË®≠Ëµ∑ÂßãÈ´îËÑÇÁéáÊòØÁõÆÊ®ôÈ´îËÑÇÁéáÁöÑ 1.5 ÂÄçÔºà50% Ë∂ÖÊ®ôÔºâ
                        const startFatPercentage = goalFatPercentage * 1.5;
                        const totalToReduce = startFatPercentage - goalFatPercentage;
                        const alreadyReduced = startFatPercentage - currentFatPercentage;
                        fatProgress = Math.min(100, Math.max(0, (alreadyReduced / totalToReduce) * 100));
                    } else if (currentFatPercentage <= goalFatPercentage) {
                        // Â∑≤ÈÅîÂà∞ÊàñË∂ÖÈÅéÁõÆÊ®ôÈ´îËÑÇÁéá
                        fatProgress = 100;
                    }
                }

                // ËÇåËÇâÈáèÈÅîÊàêÁéáÔºöÂü∫ÊñºÁõÆÂâçËÇåËÇâÈáèËàáÁõÆÊ®ôËÇåËÇâÈáèÁöÑÂ∑ÆË∑ùË®àÁÆó
                if (currentMuscle > 0 && goalMuscle > 0) {
                    if (currentMuscle < goalMuscle) {
                        // Â¢ûËÇåÊÉÖÊ≥Å
                        // ÂÅáË®≠Ëµ∑ÂßãËÇåËÇâÈáèÊòØÁõÆÊ®ôËÇåËÇâÈáèÁöÑ 0.8 ÂÄçÔºà20% ‰∏çË∂≥Ôºâ
                        const startMuscle = goalMuscle * 0.8;
                        const totalToGain = goalMuscle - startMuscle;
                        const alreadyGained = currentMuscle - startMuscle;
                        muscleProgress = Math.min(100, Math.max(0, (alreadyGained / totalToGain) * 100));
                    } else if (currentMuscle >= goalMuscle) {
                        // Â∑≤ÈÅîÂà∞ÊàñË∂ÖÈÅéÁõÆÊ®ôËÇåËÇâÈáè
                        muscleProgress = 100;
                    }
                }

                // Ë®àÁÆóÁ∂úÂêàÈÅîÊàêÁéá (Âä†Ê¨äÂπ≥Âùá)
                const overallProgress = Math.round((weightProgress * 0.4 + fatProgress * 0.3 + muscleProgress * 0.3));
                
                return Math.min(100, Math.max(0, overallProgress));
            }

            // Êõ¥Êñ∞ÂúñË°®
            function updateGoalProgressChart(progress) {
                const progressDecimal = progress / 100;
                
                var option = {
                    series: [{
                        type: 'liquidFill',
                        data: [progressDecimal],
                        radius: '65%',
                        center: ['50%', '50%'],
                        outline: {
                            show: true,
                            borderDistance: 3,
                            itemStyle: {
                                borderWidth: 2,
                                borderColor: '#6b7b8c'
                            }
                        },
                        backgroundStyle: { color: '#f5f7fa' },
                        label: {
                            normal: {
                                formatter: progress + '%',
                                fontSize: 20,
                                color: '#34495e',
                                fontWeight: 'bold'
                            }
                        },
                        color: [{
                            type: 'linear',
                            x: 0, y: 0, x2: 0, y2: 1,
                            colorStops: [
                                { offset: 0, color: '#9c99a2' },
                                { offset: 1, color: '#cddce6' }
                            ]
                        }]
                    }]
                };

                myChart.setOption(option);
            }

            // ÂàùÂßãË®àÁÆó‰∏¶Êõ¥Êñ∞ÂúñË°®
            const initialProgress = calculateGoalProgress();
            updateGoalProgressChart(initialProgress);

            // ËÆìÂúñË°®Ë∑üÈö®Ë¶ñÁ™óÂ§ßÂ∞èÁ∏ÆÊîæ
            window.addEventListener("resize", function () {
                myChart.resize();
            });

            // ËøîÂõûÊõ¥Êñ∞ÂáΩÊï∏Ôºå‰æõÂÖ∂‰ªñÂú∞ÊñπË™øÁî®
            return {
                update: function() {
                    const progress = calculateGoalProgress();
                    updateGoalProgressChart(progress);
                }
            };
        }
        // ÂâµÂª∫ÁõÆÊ®ôÈÅîÊàêÁéáÂúñË°®‰∏¶‰øùÂ≠òÊõ¥Êñ∞ÂáΩÊï∏
        window.goalProgressChart = createGoalProgressChart();

        // ÂâµÂª∫Ë∫´È´îÁµÑÊàêÊØî‰æãÂúìÈ§ÖÂúñ
        function createBodyCompositionPieChart() {
            // Ê∏ÖÈô§ËàäÁöÑÂúñË°®
            const chartContainer = document.querySelector("#body-composition-pie-chart");
            chartContainer.innerHTML = '';
            
            fetch('get_health_stats.php')
                .then(response => response.json())
                .then(data => {
                    const latestSkeletal = parseFloat(data.latest_skeletal_muscle) || 0;
                    const latestBodyFat = parseFloat(data.latest_body_fat) || 0;
                    const latestWeight = parseFloat(data.latest_weight) || 0;

                    // Ë®àÁÆóÂÖ∂‰ªñÁµÑÊàêÔºàÈ´îÈáç - È™®È™ºËÇå - È´îËÑÇËÇ™Ôºâ
                    const otherComposition = Math.max(0, latestWeight - latestSkeletal - latestBodyFat);

                    const options = {
                        series: [latestSkeletal, latestBodyFat, otherComposition],
                        chart: {
                            type: 'donut',
                            height: 260
                        },
                        labels: ['È™®È™ºËÇå', 'È´îËÑÇËÇ™', 'ÂÖ∂‰ªñ'],
                        colors: ['#BFC5DB', '#B2ABC5', '#C7C7C7'],
                        dataLabels: {
                            enabled: true,
                            formatter: function (val, opts) {
                                return opts.w.globals.series[opts.seriesIndex].toFixed(1) + ' kg';
                            }
                        },
                        legend: {
                            position: 'bottom'
                        },
                        plotOptions: {
                            pie: {
                                donut: {
                                    size: '60%',
                                    labels: {
                                        show: true,
                                        total: {
                                            show: true,
                                            label: 'Á∏ΩÈáçÈáè',
                                            formatter: function (w) {
                                                return w.globals.seriesTotals.reduce((a, b) => a + b, 0).toFixed(1) + ' kg';
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    };

                    const chart = new ApexCharts(chartContainer, options);
                    chart.render();
                })
                .catch(error => {
                    console.error('Error creating body composition pie chart:', error);
                });
        }

        // ËºâÂÖ•Ë∫´È´îÁµÑÊàêÊØî‰æãÂúñË°®
        createBodyCompositionPieChart();

        // Ë®≠ÂÆöÁõÆÊ®ôÂäüËÉΩ
        document.getElementById('saveGoalBtn').addEventListener('click', function() {
            const goalWeight = document.getElementById('goal_weight').value;
            const goalFatPercentage = document.getElementById('goal_fat_percentage').value;
            const goalMuscle = document.getElementById('goal_muscle').value;

            // Êõ¥Êñ∞È°ØÁ§∫ÁöÑÁõÆÊ®ôÂÄº
            document.getElementById('goal-weight-display').textContent = goalWeight;
            document.getElementById('goal-fat-percentage-display').textContent = goalFatPercentage;
            document.getElementById('goal-muscle-display').textContent = goalMuscle;

            // ÈóúÈñâË®≠ÂÆöÁõÆÊ®ôË¶ñÁ™ó
            const setGoalModal = bootstrap.Modal.getInstance(document.getElementById('setGoalModal'));
            setGoalModal.hide();

            // Êõ¥Êñ∞ÁõÆÊ®ôÈÅîÊàêÁéáÂúñË°®
            if (window.goalProgressChart) {
                window.goalProgressChart.update();
            }

            // È°ØÁ§∫ÊàêÂäüÊèêÁ§∫
            document.getElementById('successMessage').textContent = 'ÁõÆÊ®ôË®≠ÂÆöÊàêÂäüÔºÅ';
            const successModal = new bootstrap.Modal(document.getElementById('successModal'));
            successModal.show();
        });

        // ‰øùÂ≠òÊï∏ÊìöÊåâÈàïÈªûÊìä‰∫ã‰ª∂
        document.getElementById('saveDataBtn').addEventListener('click', function () {
            // È°ØÁ§∫‰øùÂ≠ò‰∏≠ÁãÄÊÖã
            const saveBtn = document.getElementById('saveDataBtn');
            saveBtn.disabled = true;
            saveBtn.textContent = '‰øùÂ≠ò‰∏≠...';

            const form = document.getElementById('healthDataForm');
            const formData = new FormData(form);

            // Â∞áFormDataËΩâÊèõÁÇ∫JSONÂ∞çË±°
            const data = {};
            formData.forEach((value, key) => {
                data[key] = value;
            });

            // ÁôºÈÄÅÊï∏ÊìöÂà∞ÊúçÂãôÂô®
            fetch('save_health_data.php', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data)
            })
                .then(response => response.json())
                .then(result => {
                    // ÊÅ¢Âæ©ÊåâÈàïÁãÄÊÖã
                    saveBtn.disabled = false;
                    saveBtn.textContent = '‰øùÂ≠òÊï∏Êìö';

                    if (result.success) {
                        // È°ØÁ§∫ÊàêÂäüÊ∂àÊÅØ
                        document.getElementById('successMessage').textContent = result.message;
                        const successModal = new bootstrap.Modal(document.getElementById('successModal'));
                        successModal.show();

                        // ÈóúÈñâÊñ∞Â¢ûÊï∏ÊìöË¶ñÁ™ó
                        const addDataModal = bootstrap.Modal.getInstance(document.getElementById('addDataModal'));
                        addDataModal.hide();

                        // ÈáçÁΩÆË°®ÂñÆ
                        form.reset();
                        // ÈáçÊñ∞Ë®≠ÁΩÆ‰ªäÂ§©ÁöÑÊó•ÊúüÁÇ∫ÈªòË™çÂÄº
                        const today = new Date();
                        const year = today.getFullYear();
                        const month = String(today.getMonth() + 1).padStart(2, '0');
                        const day = String(today.getDate()).padStart(2, '0');
                        document.getElementById('test_date').value = `${year}-${month}-${day}`;

                        // ÈáçÊñ∞ËºâÂÖ•Áµ±Ë®àÊï∏Êìö
                        fetch('get_health_stats.php')
                            .then(response => response.json())
                            .then(data => {
                                document.getElementById('total-records').textContent = data.total_records + ' Á≠Ü';
                                document.getElementById('avg-weight').textContent = data.latest_weight + ' kg';
                                document.getElementById('avg-height').textContent = data.latest_height + ' cm';
                                document.getElementById('avg-skeletal').textContent = data.latest_skeletal_muscle + ' kg';
                                document.getElementById('avg-body-fat').textContent = data.latest_body_fat + ' kg';
                                document.getElementById('avg-fat-percentage').textContent = data.latest_fat_percentage + '%';
                                document.getElementById('avg-metabolism').textContent = data.latest_basal_metabolism + ' kcal';
                                document.getElementById('avg-bmi').textContent = data.latest_bmi;
                            })
                            .catch(error => {
                                console.error('Error reloading health stats:', error);
                            });

                        // ÈáçÊñ∞ËºâÂÖ•ÂúñË°®Êï∏Êìö
                        const startDate = document.getElementById('start-date').value;
                        const endDate = document.getElementById('end-date').value;
                        if (startDate && endDate) {
                            loadChartData(startDate, endDate);
                        } else {
                            loadChartData();
                        }
                    } else {
                        // È°ØÁ§∫ÈåØË™§Ê∂àÊÅØ
                        document.getElementById('errorMessage').textContent = result.error || '‰øùÂ≠òÊï∏ÊìöÊôÇÁôºÁîüÈåØË™§';
                        const errorModal = new bootstrap.Modal(document.getElementById('errorModal'));
                        errorModal.show();
                    }
                })
                .catch(error => {
                    // ÊÅ¢Âæ©ÊåâÈàïÁãÄÊÖã
                    saveBtn.disabled = false;
                    saveBtn.textContent = '‰øùÂ≠òÊï∏Êìö';

                    console.error('Error:', error);
                    document.getElementById('errorMessage').textContent = 'Á∂≤Áµ°ÈåØË™§ÔºåË´ãÁ®çÂæåÂÜçË©¶';
                    const errorModal = new bootstrap.Modal(document.getElementById('errorModal'));
                    errorModal.show();
                });
        });
    </script>
</body>

</html>