<!DOCTYPE html>
<html lang="zh-Hant">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¥ç¿’ç”Ÿï½œæ­·å²ç´€éŒ„</title>
    <link rel="icon" href="images/fitness.png" type="image/png">

    <!-- å­—é«” & Bootstrap -->
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="assets/css/bootstrap.css">
    <link rel="stylesheet" href="assets/vendors/bootstrap-icons/bootstrap-icons.css">
    <link rel="stylesheet" href="assets/css/app.css">

    <!-- è‡ªè¨‚æ¨£å¼ -->
    <style>
        #favorite-list table {
            border: 4px double #212529 !important;
            border-collapse: collapse;
        }

        #favorite-list table th,
        #favorite-list table td {
            border: 3px double #495057 !important;
            vertical-align: middle;
        }

        /* çµ±ä¸€ã€Œåç¨±ã€èˆ‡ã€Œç›®æ¨™è‚Œç¾¤ã€å­—é«”æ¨£å¼ */
        #favorite-list td:nth-child(2),
        #favorite-list td:nth-child(3) {
            font-family: 'Nunito', sans-serif !important;
            font-size: 1rem !important;
            font-weight: 600 !important;
            color: #6c757d !important;
        }

        /* è¡¨æ ¼å…§æ‰€æœ‰ç´°ç¯€çµ±ä¸€ç°è‰² */
        #favorite-list td {
            color: #6c757d !important;
        }

        .training-details {
            display: flex;
            justify-content: space-between;
            text-align: center;
        }

        .training-details div {
            flex: 1;
            padding: 4px 6px;
            border-right: 3px double #495057;
        }

        .training-details div:last-child {
            border-right: none;
        }

        .training-details strong {
            display: block;
            margin-bottom: 4px;
        }

        /* å‹•ä½œè©³æƒ…ï¼šè«è˜­è¿ªè—ç° */
        .btn-detail {
            background-color: #7f90a9 !important;
            border: none;
            color: #fff !important;
        }

        .btn-detail:hover,
        .btn-detail:active,
        .btn-detail:focus {
            background-color: #67798f !important;
            color: #fff !important;
            outline: none !important;
            box-shadow: none !important;
        }

        /* ç§»é™¤ï¼šè«è˜­è¿ªç´«ç´… */
        .btn-remove {
            background-color: #94696d !important;
            border: none;
            color: #fff !important;
        }

        .btn-remove:hover,
        .btn-remove:active,
        .btn-remove:focus {
            background-color: #7a5558 !important;
            color: #fff !important;
            outline: none !important;
            box-shadow: none !important;
        }

        /* è¡¨æ ¼èˆ‡ footer é–“è· */
        #favorite-list {
            margin-bottom: 60px;
        }

        .mb-4-3 {
            margin-bottom: 2.1rem !important;
        }

        /* çµ±è¨ˆå¡ç‰‡æ¨£å¼ */
        .card.bg-primary,
        .card.bg-success,
        .card.bg-info {
            border: none;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s ease-in-out;
        }

        .card.bg-primary:hover,
        .card.bg-success:hover,
        .card.bg-info:hover {
            transform: translateY(-2px);
        }

        /* æœå°‹å’Œæ§åˆ¶é¢æ¿æ¨£å¼ */
        .input-group .form-control:focus {
            border-color: #0d6efd;
            box-shadow: 0 0 0 0.2rem rgba(13, 110, 253, 0.25);
        }

        /* è¨˜éŒ„å¡ç‰‡ body â†’ ç™½è‰²èƒŒæ™¯ */
        .card.shadow-lg {
            background-color: #ffffff !important;
            color: #333333 !important;
            transition: all 0.3s ease;
        }

        .card.shadow-lg:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15) !important;
        }

        /* å¡ç‰‡ header â†’ æ·±è«è˜­è¿ªç¶ ç° */
        .card-header.bg-gradient-primary {
            background-color: #edf0ed !important;
            color: #ffffff !important;
        }

        /* éŸ¿æ‡‰å¼èª¿æ•´ */
        @media (max-width: 768px) {

            .card-body .row .col-4,
            .card-body .row .col-6 {
                margin-bottom: 0.5rem;
            }

            .border-end {
                border-right: none !important;
                border-bottom: 1px solid #dee2e6 !important;
                padding-bottom: 0.5rem;
                margin-bottom: 0.5rem;
            }
        }

        /* çµ±è¨ˆå¡ç‰‡ (çµ±ä¸€æ·±è«è˜­è¿ªç¶ ç°) */
        .card.bg-primary,
        .card.bg-success,
        .card.bg-info {
            background-color: #bbc2bd !important;
            color: #fff !important;
        }

        /* çµ±ä¸€å¡ç‰‡å…§æ¨™é¡Œé¡è‰² */
        .card.shadow-lg strong {
            color: #646c8f !important;
            /* è·Ÿ header ä¸€æ¨£çš„æ·±è«è˜­è¿ªç¶ ç° */
        }

        /* å¡ç‰‡å…§å®¹ç½®ä¸­å°é½Š */
        .card.shadow-lg .card-body {
            display: flex;
            flex-direction: column;
            justify-content: center;
            /* å‚ç›´ç½®ä¸­ */
            height: 100%;
            /* å¡«æ»¿å¡ç‰‡é«˜åº¦ */
        }
    </style>
</head>

<body>
    <div id="app">
        <div id="sidebar" class="active">
            <div class="sidebar-wrapper active">
                <div class="sidebar-menu">
                    <ul class="menu">
                        <li class="sidebar-title">æˆ‘çš„æª”æ¡ˆ</li>

                        <li class="sidebar-item">
                            <a href="index.html" class='sidebar-link'>
                                <i class="bi bi-file-earmark-medical-fill"></i>
                                <span>å¥åº·å„€è¡¨æ¿</span>
                            </a>
                        </li>
                        <li class="sidebar-item">
                            <a href="profile.html" class='sidebar-link'>
                                <i class="bi bi-person-badge-fill"></i>
                                <span>åŸºæœ¬è³‡æ–™</span>
                            </a>
                        </li>
                        <li class="sidebar-item active">
                            <a href="history.html" class='sidebar-link'>
                                <i class="bi bi-pen-fill"></i>
                                <span>æ­·å²ç´€éŒ„</span>
                            </a>
                        </li>
                        <li class="sidebar-title">æ™ºæ…§å»ºè­°</li>
                        <li class="sidebar-item">
                            <a href="training.html" class='sidebar-link'>
                                <i class="bi bi-pentagon-fill"></i>
                                <span>è¨“ç·´æ¢ç´¢</span>
                            </a>
                        </li>
                        <li class="sidebar-item">
                            <a href="food.html" class='sidebar-link'>
                                <i class="bi bi-basket-fill"></i>
                                <span>é£²é£ŸæŒ‡å—</span>
                            </a>
                        </li>
                        <li class="sidebar-item">
                            <a href="favorite.html" class='sidebar-link'>
                                <i class="bi bi-grid-1x2-fill"></i>
                                <span>æˆ‘çš„æœ€æ„›</span>
                            </a>
                        </li>
                        <li class="sidebar-title">æ›´å¤šé¸é …</li>
                        <li class="sidebar-item">
                            <a href="logout.php" class='sidebar-link'>
                                <i class="bi bi-egg-fill"></i>
                                <span>ç™»å‡ºå¸³æˆ¶</span>
                            </a>
                        </li>
                    </ul>
                </div>
                <button class="sidebar-toggler btn x"><i data-feather="x"></i></button>
            </div>
        </div>
        <div id="main">
            <header class="mb-3">
                <a href="#" class="burger-btn d-block d-xl-none">
                    <i class="bi bi-justify fs-3"></i>
                </a>
            </header>

            <div class="page-heading">
                <div class="page-title">
                    <div class="row">
                        <div class="col-12 col-md-6 order-md-1 order-last">
                            <h3 class="mb-4-3 me-3">æ­·å²ç´€éŒ„ğŸ“Š</h3>
                            <p class="text-muted mt-2 mb-4" style="font-size: 1rem;">
                                ä»¥ä¸‹æ˜¯æ‚¨çš„å¥åº·æ•¸æ“šè¨˜éŒ„ï¼ŒåŒ…å«é«”é‡ã€é«”è„‚ã€éª¨éª¼è‚Œç­‰è©³ç´°è³‡è¨Šï¼Œæ–¹ä¾¿æ‚¨è¿½è¹¤èº«é«”è®ŠåŒ–ã€‚
                            </p>
                        </div>
                        <div class="col-12 col-md-6 order-md-2 order-first">
                            <nav aria-label="breadcrumb" class="breadcrumb-header float-start float-lg-end">
                                <ol class="breadcrumb">
                                    <li class="breadcrumb-item"><a href="index.html">å¥åº·å„€è¡¨æ¿</a></li>
                                    <li class="breadcrumb-item active" aria-current="page">æ­·å²ç´€éŒ„</li>
                                </ol>
                            </nav>
                        </div>
                    </div>
                </div>
            </div>

            <!-- çµ±è¨ˆè³‡è¨Š -->
            <div class="container">
                <section class="section">
                    <div id="stats-container"></div>
                </section>
            </div>

            <!-- æ­·å²è¨˜éŒ„æ¸…å–® -->
            <div class="container">
                <section class="section">
                    <div id="history-list" class="row g-4"></div>
                </section>
            </div>

            <footer>
                <div class="footer clearfix mb-0 text-muted">
                    <div class="float-start">
                        <p>å¥ç¿’ç”Ÿ</p>
                    </div>
                    <div class="float-end">
                        <p>è¬æ˜€å€¢ é»ƒè© ç¿° å‘‚æ²å£ æ¸¸åšç¿”</p>
                    </div>
                </div>
            </footer>
        </div>
    </div>

    <script>
        async function loadHistory() {
            try {
                const response = await fetch("get_history.php", {
                    credentials: "include"
                });

                const text = await response.text();
                console.log("ä¼ºæœå™¨å›å‚³:", text);

                let result;
                try {
                    result = JSON.parse(text);
                } catch (e) {
                    document.getElementById("history-list").innerHTML =
                        `<div class="alert alert-danger" role="alert">
                            <i class="bi bi-exclamation-triangle-fill me-2"></i>
                            ä¼ºæœå™¨å›å‚³çš„ä¸æ˜¯ JSONï¼Œè«‹æª¢æŸ¥ console log
                        </div>`;
                    return;
                }

                if (!result.success) {
                    document.getElementById("history-list").innerHTML =
                        `<div class="alert alert-danger" role="alert">
                            <i class="bi bi-exclamation-triangle-fill me-2"></i>
                            ${result.error || 'è¼‰å…¥è³‡æ–™æ™‚ç™¼ç”ŸéŒ¯èª¤'}
                        </div>`;
                    return;
                }

                updateStats(result.stats);
                renderData(result.data);

            } catch (err) {
                console.error("âŒ è¼‰å…¥å¤±æ•—:", err);
                document.getElementById("history-list").innerHTML =
                    `<div class="alert alert-danger" role="alert">
                        <i class="bi bi-exclamation-triangle-fill me-2"></i>
                        è¼‰å…¥ç´€éŒ„æ™‚ç™¼ç”ŸéŒ¯èª¤: ${err.message}
                    </div>`;
            }
        }

        function updateStats(stats) {
            const statsContainer = document.getElementById("stats-container");
            if (statsContainer) {
                statsContainer.innerHTML = `
                    <div class="row mb-4">
                        <div class="col-md-12">
                            <div class="card bg-primary text-white">
                                <div class="card-body text-center">
                                    <h4 class="card-title">${stats.total_records}</h4>
                                    <p class="card-text">æ‚¨çš„å¥åº·è¨˜éŒ„ç¸½æ•¸</p>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }
        }

        function renderData(data) {
            const container = document.getElementById("history-list");
            container.innerHTML = "";

            if (data.length === 0) {
                container.innerHTML = `
                    <div class="col-12">
                        <div class="alert alert-info text-center" role="alert">
                            <i class="bi bi-info-circle-fill me-2"></i>
                            ç›®å‰æ²’æœ‰æ­·å²ç´€éŒ„ï¼Œè«‹å…ˆæ–°å¢å¥åº·æ•¸æ“š
                        </div>
                    </div>
                `;
                return;
            }

            data.forEach((record, index) => {
                const card = document.createElement("div");
                card.className = "col-12 col-md-6 col-lg-4 mb-4";

                card.innerHTML = `
                    <div class="card shadow-lg border-0 rounded-4 h-100">
                        <div class="card-header bg-gradient-primary text-white">
                            <h5 class="card-title mb-1">
                                ğŸ“… ${record.Date} 
                                <small class="opacity-75">#${index + 1}</small>
                            </h5>
                        </div>
                        <div class="card-body">
                            <div class="row mb-3">
                                <div class="col-4 text-center">
                                    <div class="border-end">
                                        <strong class="d-block text-primary">å¹´é½¡</strong>
                                        <span class="text-muted">${record.age}</span>
                                    </div>
                                </div>
                                <div class="col-4 text-center">
                                    <div class="border-end">
                                        <strong class="d-block text-primary">èº«é«˜</strong>
                                        <span class="text-muted">${record.height_cm} cm</span>
                                    </div>
                                </div>
                                <div class="col-4 text-center">
                                    <strong class="d-block text-primary">é«”é‡</strong>
                                    <span class="text-muted">${record.weight_kg} kg</span>
                                </div>
                            </div>
                            
                            <div class="row mb-3">
                                <div class="col-4 text-center">
                                    <div class="border-end">
                                        <strong class="d-block text-success">éª¨éª¼è‚Œ</strong>
                                        <span class="text-muted">${record.skeletal_muscle} kg</span>
                                    </div>
                                </div>
                                <div class="col-4 text-center">
                                    <div class="border-end">
                                        <strong class="d-block text-warning">é«”è„‚é‡</strong>
                                        <span class="text-muted">${record.body_fat} kg</span>
                                    </div>
                                </div>
                                <div class="col-4 text-center">
                                    <strong class="d-block text-info">é«”è„‚ç‡</strong>
                                    <span class="text-muted">${record.fat_percentage}%</span>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-6 text-center">
                                    <div class="border-end">
                                        <strong class="d-block text-danger">åŸºç¤ä»£è¬</strong>
                                        <span class="text-muted">${record.basal_metabolism} kcal</span>
                                    </div>
                                </div>
                                <div class="col-6 text-center">
                                    <strong class="d-block text-secondary">BMI</strong>
                                    <span class="text-muted">${record.bmi}</span>
                                </div>
                            </div>
                        </div>
                        <div class="card-footer bg-light">
                            <small class="text-muted">
                                <i class="bi bi-clock me-1"></i>
                                è¨˜éŒ„ ID: ${record.record_id.substring(0, 8)}...
                            </small>
                        </div>
                    </div>
                `;
                container.appendChild(card);
            });
        }

        // é é¢è¼‰å…¥æ™‚åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function () {
            loadHistory();
        });
    </script>

</body>

</html>